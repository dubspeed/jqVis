<html>
<head>
	<link rel="stylesheet" type="text/css" href="lib/codemirror.css">
	<link rel="stylesheet" type="text/css" href="jqvis.css"></link>
    <script type="text/javascript">
/* <![CDATA[ */
    (function() {
        var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
        s.type = 'text/javascript';
        s.async = true;
        s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto';
        t.parentNode.insertBefore(s, t);
    })();
/* ]]> */</script>
    <script src="lib/codemirror.js"></script>
	<script src="lib/mode/xml/xml.js"></script>
    <script src="lib/mode/javascript/javascript.js"></script>
    <script src="lib/mode/css/css.js"></script>
    <script src="lib/mode/htmlmixed/htmlmixed.js"></script>
	<script src="lib/jquery_1.7.2_dev.js" type="text/javascript" charset="utf-8"></script>
	<script src="src/dub.js" type="text/javascript" charset="utf-8"></script>
	<script src="src/jqvis.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function() {
            var editor = undefined,

            createEditor = function() {
            	editor = CodeMirror.fromTextArea($("#editor")[0], {
                    lineNumbers : true,
                    matchBrackets : true
                });
            },
            
            message = $("section p.message"), 
            
            vis = Object.create(jqvis),
            
            lastMarker = undefined,
            
            clearMarkers = function() {
                 if (lastMarker) {
                     for (var i=0; i<lastMarker.length; i += 1) {
                         editor.clearMarker(lastMarker[i]);
                     }
                 }             
            },

            setMarkers = function(lines) {
                 lastMarker = lines;
                 for (var i=0; i<lines.length; i += 1) {
                     editor.setMarker(lines[i], "<div class='highlight_line'>%N%</div>"); //, className)
                 }
            },
            
            showResult = function(lines) {
                if (vis.getLastError() !== null) {
                    message.text(vis.getLastError());
                    message.slideDown();
                 } else if (lines.length == 0) {
                     message.text("Your query did not return any valid results")
                     message.slideDown();    
                 } else {
                     message.slideUp();
                     setMarkers(lines);
                 }
            },
            
			queryEvent = function(evt) {
            	 evt.preventDefault();
			     clearMarkers();
			     vis.setHTML(editor.getValue());
			     vis.query($("#query").val());
			     showResult(vis.getLines());
			},
			
			toggleHover = function(evt) {
			     $(this).toggleClass("button_hover");          
			},
			
			loadExampleFile = function(name) {
				var xmlReq = $.get (name).success(function(data) {
	                $("textarea#editor").text(xmlReq.responseText);
	                createEditor();
	            });
			};

            vis.setMark("<mark>", "</mark>");

			$("#submit").bind("click", queryEvent);
			$("#submit").bind("hover", toggleHover);
			message.hide();
			loadExampleFile("example.html");
			
		});
	</script>
</head>
<body>
    <header class="softshadow">
        <h1>JQuery Visualizer</h1>
		<div id="flattr">
			<a class="FlattrButton" style="display: none;"
				href="http://jqvis.dubspeed.de"></a>
			<noscript>
				<a href="http://flattr.com/thing/720580/JQVis" target="_blank">
					<img src="http://api.flattr.com/button/flattr-badge-large.png"
					alt="Flattr this" title="Flattr this" border="0" />
				</a>
			</noscript>
		</div>
		<a href="https://github.com/you"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
    </header>
 
    <div class="from_top"></div>
 
    <section>
        <p>This tool lets you see your jQuery-query results by highlighting the markup you provide in the edit below. 
        Please try it! Paste your code in the editor below, enter your query as jQuery selector and see the magic happen! 
        Examples are: <code>p</code>, <code>p:first</code>, <code>li:last</code>, <code>p#id</code> or <code>p.class</code>.
        <a href="">Check out my blogpost discussing this project</a> or
        <a href="http://api.jquery.com/category/selectors/">Learn more about jQuery selectors.</a></p>
	</section>
       
    <section>
        <div id="submit" class="button softshadow">query</div>
        <textarea id="query">p</textarea>
    </section>
    
    <section>
        <p class="message solid_border softshadow"></p>
    </section>
    
   
    <div class="rows">
        <div class="solid_border leftarea">
            <form>
            <textarea id="editor" name="editor">
            
            </textarea>
            </form>
        </div>
        
    </div>

    <footer>
    </footer>

</body>
</html>